var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);import{j as n}from"./ui-Ct5cQbGm.js";import{r}from"./router-BzeIgkns.js";import{B as i,C as s,a,b as o,d as l}from"./index-DNzaZn5L.js";import{T as c,a as d,b as u,c as m}from"./tabs-Bl6rwV-i.js";import{S as p}from"./scroll-area-DUzSH_QX.js";import{B as h}from"./badge-Do-isio7.js";import{W as f}from"./webcontainer-B_DT545e.js";import{x,P as w,R as j,G as v,aC as b,c as y}from"./icons-Cz8iQkUU.js";import"./vendor-DEQ385Nk.js";import"./utils-Bmne0XXo.js";import"./firebase-rW0Qch21.js";import"./index-jVOyRz7F.js";const g=class e{constructor(){t(this,"webContainer",null),t(this,"isBooting",!1)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async initialize(){if(!this.webContainer&&!this.isBooting){this.isBooting=!0;try{this.webContainer=await f.boot()}catch(e){throw e}finally{this.isBooting=!1}}}isReady(){return null!==this.webContainer}async mountFiles(e){if(!this.webContainer)throw new Error("WebContainer not initialized");await this.webContainer.mount(e)}async installDependencies(){if(!this.webContainer)throw new Error("WebContainer not initialized");try{const e=await this.webContainer.spawn("npm",["install"]),t=await this.streamOutput(e),n=await e.exit;return{success:0===n,output:t,...0!==n&&{error:`Install failed with exit code ${n}`}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Install failed"}}}async startDevServer(){if(!this.webContainer)throw new Error("WebContainer not initialized");try{const e=await this.webContainer.spawn("npm",["run","dev"]);return new Promise(t=>{let n="";e.output.pipeTo(new WritableStream({write:e=>{n+=e,(e.includes("Local:")||e.includes("localhost"))&&t({success:!0,output:n,url:"http://localhost:3000"})}})),setTimeout(()=>{t({success:!0,output:n,url:"http://localhost:3000"})},1e4)})}catch(e){return{success:!1,error:e instanceof Error?e.message:"Server start failed"}}}async executeCommand(e,t=[]){if(!this.webContainer)throw new Error("WebContainer not initialized");try{const n=await this.webContainer.spawn(e,t),r=await this.streamOutput(n),i=await n.exit;return{success:0===i,output:r,...0!==i&&{error:`Command failed with exit code ${i}`}}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Command execution failed"}}}async writeFile(e,t){if(!this.webContainer)throw new Error("WebContainer not initialized");await this.webContainer.fs.writeFile(e,t)}async readFile(e){if(!this.webContainer)throw new Error("WebContainer not initialized");return this.webContainer.fs.readFile(e,"utf-8")}async listDirectory(e){if(!this.webContainer)throw new Error("WebContainer not initialized");return this.webContainer.fs.readdir(e)}async streamOutput(e){let t="";const n=e.output.getReader();for(;;){const{done:e,value:r}=await n.read();if(e)break;t+=r}return t}async cleanup(){this.webContainer&&(this.webContainer=null)}};t(g,"instance");let C=g;function N({files:e,className:t}){const{isReady:f,isLoading:g,error:N,output:R,previewUrl:S,mountProject:k,installDependencies:E,startDevServer:L,executeCommand:F,clearOutput:W}=(()=>{const[e,t]=r.useState({isReady:!1,isLoading:!1,error:null,output:"",previewUrl:null}),n=C.getInstance(),i=r.useCallback(async()=>{if(!e.isReady){t(e=>({...e,isLoading:!0,error:null}));try{await n.initialize(),t(e=>({...e,isReady:!0,isLoading:!1,output:e.output+"WebContainer initialized successfully\n"}))}catch(N){t(t=>({...t,isLoading:!1,error:N instanceof Error?N.message:"Failed to initialize WebContainer"}))}}},[e.isReady,n]),s=r.useCallback(async r=>{if(!e.isReady)return t(e=>({...e,error:"WebContainer not ready"})),!1;t(e=>({...e,isLoading:!0,error:null}));try{return await n.mountFiles(r),t(e=>({...e,isLoading:!1,output:e.output+"Project files mounted successfully\n"})),!0}catch(N){return t(t=>({...t,isLoading:!1,error:N instanceof Error?N.message:"Failed to mount files"})),!1}},[e.isReady,n]),a=r.useCallback(async()=>{if(!e.isReady)return t(e=>({...e,error:"WebContainer not ready"})),!1;t(e=>({...e,isLoading:!0,error:null}));try{const e=await n.installDependencies();return t(t=>({...t,isLoading:!1,output:t.output+(e.output||"")+"\n",error:e.error||null})),e.success}catch(N){return t(t=>({...t,isLoading:!1,error:N instanceof Error?N.message:"Failed to install dependencies"})),!1}},[e.isReady,n]),o=r.useCallback(async()=>{if(!e.isReady)return t(e=>({...e,error:"WebContainer not ready"})),!1;t(e=>({...e,isLoading:!0,error:null}));try{const e=await n.startDevServer();return t(t=>({...t,isLoading:!1,output:t.output+(e.output||"")+"\n",previewUrl:e.url||null,error:e.error||null})),e.success}catch(N){return t(t=>({...t,isLoading:!1,error:N instanceof Error?N.message:"Failed to start dev server"})),!1}},[e.isReady,n]),l=r.useCallback(async(r,i=[])=>{if(!e.isReady){const e="WebContainer not ready";return t(t=>({...t,error:e})),{success:!1,error:e}}t(e=>({...e,isLoading:!0,error:null}));try{const e=await n.executeCommand(r,i);return t(t=>({...t,isLoading:!1,output:t.output+`$ ${r} ${i.join(" ")}\n`+(e.output||"")+"\n",error:e.error||null})),e}catch(N){const n=N instanceof Error?N.message:"Command execution failed";return t(e=>({...e,isLoading:!1,error:n})),{success:!1,error:n}}},[e.isReady,n]),c=r.useCallback(async(r,i)=>{if(!e.isReady)return t(e=>({...e,error:"WebContainer not ready"})),!1;try{return await n.writeFile(r,i),t(e=>({...e,output:e.output+`File written: ${r}\n`})),!0}catch(N){return t(t=>({...t,error:N instanceof Error?N.message:"Failed to write file"})),!1}},[e.isReady,n]),d=r.useCallback(async r=>{if(!e.isReady)return t(e=>({...e,error:"WebContainer not ready"})),null;try{const e=await n.readFile(r);return t(e=>({...e,output:e.output+`File read: ${r}\n`})),e}catch(N){return t(t=>({...t,error:N instanceof Error?N.message:"Failed to read file"})),null}},[e.isReady,n]),u=r.useCallback(()=>{t(e=>({...e,output:"",error:null}))},[]),m=r.useCallback(async()=>{await n.cleanup(),t({isReady:!1,isLoading:!1,error:null,output:"",previewUrl:null})},[n]);return r.useEffect(()=>(i(),()=>{m()}),[]),{...e,initialize:i,mountProject:s,installDependencies:a,startDevServer:o,executeCommand:l,writeFile:c,readFile:d,clearOutput:u,cleanup:m}})(),[z,P]=r.useState(!1),[O,T]=r.useState(!1),D=async()=>{if(f)try{if(await k(e)){P(!0);if(await E()){await L()&&T(!0)}}}catch(t){}},A=async e=>{const[t,...n]=e.split(" ");await F(t,n)};return r.useEffect(()=>{f&&e&&!z&&D()},[f,e,z]),n.jsxs("div",{className:`space-y-4 ${t}`,children:[n.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(h,{variant:f?"default":"secondary",children:f?"Ready":"Initializing"}),z&&n.jsx(h,{variant:"outline",children:"Project Loaded"}),O&&n.jsx(h,{variant:"default",children:"Server Running"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(i,{size:"sm",variant:"outline",onClick:D,disabled:!f||g,children:[g?n.jsx(x,{className:"h-4 w-4 animate-spin"}):n.jsx(w,{className:"h-4 w-4"}),"Load Project"]}),z&&n.jsxs(i,{size:"sm",variant:"outline",onClick:async()=>{T(!1);await L()&&T(!0)},disabled:g,children:[n.jsx(j,{className:"h-4 w-4"}),"Restart Server"]})]})]}),N&&n.jsxs(s,{className:"border-destructive",children:[n.jsx(a,{className:"pb-2",children:n.jsx(o,{className:"text-destructive text-sm",children:"Error"})}),n.jsx(l,{children:n.jsx("pre",{className:"text-sm text-destructive whitespace-pre-wrap",children:N})})]}),n.jsxs(c,{defaultValue:"preview",className:"w-full",children:[n.jsxs(d,{className:"grid w-full grid-cols-3",children:[n.jsxs(u,{value:"preview",className:"flex items-center space-x-2",children:[n.jsx(v,{className:"h-4 w-4"}),n.jsx("span",{children:"Preview"})]}),n.jsxs(u,{value:"terminal",className:"flex items-center space-x-2",children:[n.jsx(b,{className:"h-4 w-4"}),n.jsx("span",{children:"Terminal"})]}),n.jsxs(u,{value:"files",className:"flex items-center space-x-2",children:[n.jsx(y,{className:"h-4 w-4"}),n.jsx("span",{children:"Files"})]})]}),n.jsx(m,{value:"preview",className:"mt-4",children:n.jsxs(s,{children:[n.jsx(a,{children:n.jsxs(o,{className:"flex items-center justify-between",children:[n.jsx("span",{children:"Live Preview"}),S&&n.jsx(i,{size:"sm",variant:"outline",onClick:()=>window.open(S,"_blank"),children:"Open in New Tab"})]})}),n.jsx(l,{className:"p-0",children:S?n.jsx("iframe",{src:S,className:"w-full h-96 border-0 rounded-b-lg",title:"Live Preview"}):n.jsx("div",{className:"h-96 flex items-center justify-center text-muted-foreground",children:O?"Loading preview...":"Start the development server to see preview"})})]})}),n.jsx(m,{value:"terminal",className:"mt-4",children:n.jsxs(s,{children:[n.jsxs(a,{className:"flex flex-row items-center justify-between",children:[n.jsx(o,{children:"Terminal Output"}),n.jsx(i,{size:"sm",variant:"outline",onClick:W,children:"Clear"})]}),n.jsxs(l,{children:[n.jsx(p,{className:"h-96 w-full",children:n.jsx("pre",{className:"text-sm font-mono whitespace-pre-wrap",children:R||"No output yet..."})}),n.jsxs("div",{className:"mt-4 flex space-x-2",children:[n.jsx("input",{type:"text",placeholder:"Enter command (e.g., npm run build)",className:"flex-1 px-3 py-2 border rounded-md text-sm",onKeyDown:e=>{if("Enter"===e.key){const t=e.target.value;t.trim()&&(A(t),e.target.value="")}},disabled:!f||g}),n.jsx(i,{size:"sm",onClick:()=>{const e=document.querySelector('input[placeholder*="Enter command"]');e?.value.trim()&&(A(e.value),e.value="")},disabled:!f||g,children:"Run"})]})]})]})}),n.jsx(m,{value:"files",className:"mt-4",children:n.jsxs(s,{children:[n.jsx(a,{children:n.jsx(o,{children:"Project Files"})}),n.jsx(l,{children:n.jsx(p,{className:"h-96 w-full",children:n.jsx("div",{className:"space-y-2",children:Object.entries(e).map(([e,t])=>n.jsxs("div",{className:"border rounded p-2",children:[n.jsx("div",{className:"font-mono text-sm font-medium",children:e}),"file"in t&&t.file&&"contents"in t.file&&n.jsx("pre",{className:"text-xs text-muted-foreground mt-1 whitespace-pre-wrap overflow-hidden",children:"string"==typeof t.file.contents?n.jsxs(n.Fragment,{children:[t.file.contents.substring(0,200),t.file.contents.length>200&&"..."]}):"[Binary file]"})]},e))})})})]})})]})]})}const R={"package.json":{file:{contents:JSON.stringify({name:"sample-react-app",version:"1.0.0",type:"module",scripts:{dev:"vite",build:"vite build",preview:"vite preview"},dependencies:{react:"^18.2.0","react-dom":"^18.2.0"},devDependencies:{"@types/react":"^18.2.43","@types/react-dom":"^18.2.17","@vitejs/plugin-react":"^4.2.1",vite:"^5.0.8"}},null,2)}},"index.html":{file:{contents:'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <title>Sample React App</title>\n  </head>\n  <body>\n    <div id="root"></div>\n    <script type="module" src="/src/main.jsx"><\/script>\n  </body>\n</html>'}},"vite.config.js":{file:{contents:"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\nexport default defineConfig({\n  plugins: [react()],\n  server: {\n    port: 3000\n  }\n})"}},src:{directory:{"main.jsx":{file:{contents:"import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App.jsx'\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n)"}},"App.jsx":{file:{contents:"import { useState } from 'react'\n\nfunction App() {\n  const [count, setCount] = useState(0)\n\n  return (\n    <div style={{ padding: '2rem', textAlign: 'center', fontFamily: 'Arial, sans-serif' }}>\n      <h1>Sample React App</h1>\n      <p>This is running in a WebContainer!</p>\n      \n      <div style={{ margin: '2rem 0' }}>\n        <button \n          onClick={() => setCount(count + 1)}\n          style={{\n            padding: '0.5rem 1rem',\n            fontSize: '1rem',\n            backgroundColor: '#007acc',\n            color: 'white',\n            border: 'none',\n            borderRadius: '4px',\n            cursor: 'pointer'\n          }}\n        >\n          Count: {count}\n        </button>\n      </div>\n      \n      <p style={{ color: '#666' }}>\n        Click the button to test React state management!\n      </p>\n    </div>\n  )\n}\n\nexport default App"}}}}},S={"package.json":{file:{contents:JSON.stringify({name:"sample-node-app",version:"1.0.0",type:"module",main:"server.js",scripts:{dev:"node server.js",start:"node server.js"},dependencies:{}},null,2)}},"server.js":{file:{contents:'import http from \'http\';\nimport url from \'url\';\n\nconst server = http.createServer((req, res) => {\n  const pathname = url.parse(req.url).pathname;\n  \n  res.writeHead(200, { \'Content-Type\': \'text/html\' });\n  \n  const html = `\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>Sample Node.js Server</title>\n      <style>\n        body { font-family: Arial, sans-serif; padding: 2rem; text-align: center; }\n        .container { max-width: 600px; margin: 0 auto; }\n        .button { padding: 0.5rem 1rem; margin: 0.5rem; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer; }\n      </style>\n    </head>\n    <body>\n      <div class="container">\n        <h1>Sample Node.js Server</h1>\n        <p>This server is running in a WebContainer!</p>\n        <p>Current time: ${new Date().toLocaleString()}</p>\n        <p>Path: ${pathname}</p>\n        <button class="button" onclick="location.reload()">Refresh</button>\n        <button class="button" onclick="window.location=\'/about\'">About</button>\n      </div>\n    </body>\n    </html>\n  `;\n  \n  res.end(html);\n});\n\nconst PORT = 3000;\nserver.listen(PORT, () => {\n  console.log(`Server running on http://localhost:${PORT}`);\n});'}}};function k(){const[e,t]=r.useState("react"),[c,d]=r.useState(R),u=e=>{t(e),d("react"===e?R:S)};return n.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[n.jsxs(s,{children:[n.jsx(a,{children:n.jsx(o,{children:"WebContainer Test Environment"})}),n.jsxs(l,{className:"space-y-4",children:[n.jsx("p",{className:"text-muted-foreground",children:"This page demonstrates the WebContainer integration for running code in the browser. Select a project type below to test live code execution."}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsx(i,{variant:"react"===e?"default":"outline",onClick:()=>u("react"),children:"React Project"}),n.jsx(i,{variant:"node"===e?"default":"outline",onClick:()=>u("node"),children:"Node.js Server"})]})]})]}),n.jsx(N,{files:c})]})}export{k as WebContainerTest};
//# sourceMappingURL=WebContainerTest-djqQ0kwL.js.map

{"version":3,"file":"RealtimeGeneration-BYsgCBaF.js","sources":["../../../src/components/ui/progress.tsx","../../../src/services/RealtimeService.ts","../../../src/components/RealtimeGeneration.tsx","../../../src/hooks/useRealtimeGeneration.ts"],"sourcesContent":["import * as React from \"react\"\r\nimport { cn } from \"../../lib/utils\"\r\n\r\ninterface ProgressProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  value?: number\r\n  max?: number\r\n}\r\n\r\nconst Progress = React.forwardRef<HTMLDivElement, ProgressProps>(\r\n  ({ className, value = 0, max = 100, ...props }, ref) => {\r\n    const percentage = Math.min(100, Math.max(0, (value / max) * 100))\r\n    \r\n    return (\r\n      <div\r\n        ref={ref}\r\n        className={cn(\r\n          \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\r\n          className\r\n        )}\r\n        {...props}\r\n      >\r\n        <div\r\n          className=\"h-full bg-primary transition-all duration-300 ease-in-out\"\r\n          style={{ width: `${percentage}%` }}\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n)\r\n\r\nProgress.displayName = \"Progress\"\r\n\r\nexport { Progress }","/**\r\n * Real-time Updates Service\r\n * Handles real-time communication for AI generation progress using Firebase Realtime Database\r\n */\r\n\r\nimport { getDatabase, ref, set, onValue, off, serverTimestamp } from 'firebase/database';\r\nimport app from '@/lib/firebase';\r\n\r\nexport interface GenerationProgress {\r\n  sessionId: string;\r\n  userId: string;\r\n  status: 'initializing' | 'analyzing' | 'generating' | 'reviewing' | 'completed' | 'error';\r\n  progress: number; // 0-100\r\n  currentStep: string;\r\n  files?: Array<{\r\n    name: string;\r\n    path: string;\r\n    content: string;\r\n    language: string;\r\n  }>;\r\n  error?: string;\r\n  timestamp: number;\r\n}\r\n\r\nexport interface StreamMessage {\r\n  type: 'progress' | 'file' | 'error' | 'complete';\r\n  data: any;\r\n  timestamp: number;\r\n}\r\n\r\nexport class RealtimeService {\r\n  private static instance: RealtimeService;\r\n  private database = getDatabase(app);\r\n  private listeners = new Map<string, () => void>();\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): RealtimeService {\r\n    if (!RealtimeService.instance) {\r\n      RealtimeService.instance = new RealtimeService();\r\n    }\r\n    return RealtimeService.instance;\r\n  }\r\n\r\n  /**\r\n   * Start a generation session with real-time updates\r\n   */\r\n  async startGenerationSession(sessionId: string, userId: string): Promise<void> {\r\n    const sessionRef = ref(this.database, `generations/${sessionId}`);\r\n    \r\n    const initialProgress: GenerationProgress = {\r\n      sessionId,\r\n      userId,\r\n      status: 'initializing',\r\n      progress: 0,\r\n      currentStep: 'Starting AI generation...',\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    await set(sessionRef, {\r\n      ...initialProgress,\r\n      createdAt: serverTimestamp(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update generation progress\r\n   */\r\n  async updateProgress(\r\n    sessionId: string, \r\n    status: GenerationProgress['status'],\r\n    progress: number,\r\n    currentStep: string,\r\n    files?: GenerationProgress['files']\r\n  ): Promise<void> {\r\n    const sessionRef = ref(this.database, `generations/${sessionId}`);\r\n    \r\n    const update: Partial<GenerationProgress> = {\r\n      status,\r\n      progress,\r\n      currentStep,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    if (files) {\r\n      update.files = files;\r\n    }\r\n\r\n    await set(sessionRef, {\r\n      ...update,\r\n      updatedAt: serverTimestamp(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Mark generation as completed\r\n   */\r\n  async completeGeneration(sessionId: string, files: GenerationProgress['files']): Promise<void> {\r\n    await this.updateProgress(sessionId, 'completed', 100, 'Generation completed successfully', files);\r\n  }\r\n\r\n  /**\r\n   * Mark generation as error\r\n   */\r\n  async errorGeneration(sessionId: string, error: string): Promise<void> {\r\n    const sessionRef = ref(this.database, `generations/${sessionId}`);\r\n    \r\n    await set(sessionRef, {\r\n      status: 'error',\r\n      progress: 0,\r\n      currentStep: 'Generation failed',\r\n      error,\r\n      timestamp: Date.now(),\r\n      updatedAt: serverTimestamp(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Listen to generation progress updates\r\n   */\r\n  subscribeToGeneration(\r\n    sessionId: string, \r\n    callback: (progress: GenerationProgress) => void\r\n  ): () => void {\r\n    const sessionRef = ref(this.database, `generations/${sessionId}`);\r\n    \r\n    const unsubscribe = onValue(sessionRef, (snapshot) => {\r\n      const data = snapshot.val();\r\n      if (data) {\r\n        callback(data as GenerationProgress);\r\n      }\r\n    });\r\n\r\n    // Store the unsubscribe function\r\n    this.listeners.set(sessionId, unsubscribe);\r\n\r\n    // Return unsubscribe function\r\n    return () => {\r\n      off(sessionRef, 'value', unsubscribe);\r\n      this.listeners.delete(sessionId);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Send real-time message to a session\r\n   */\r\n  async sendMessage(sessionId: string, message: StreamMessage): Promise<void> {\r\n    const messageRef = ref(this.database, `messages/${sessionId}/${Date.now()}`);\r\n    \r\n    await set(messageRef, {\r\n      ...message,\r\n      createdAt: serverTimestamp(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Listen to real-time messages for a session\r\n   */\r\n  subscribeToMessages(\r\n    sessionId: string,\r\n    callback: (message: StreamMessage) => void\r\n  ): () => void {\r\n    const messagesRef = ref(this.database, `messages/${sessionId}`);\r\n    \r\n    const unsubscribe = onValue(messagesRef, (snapshot) => {\r\n      const messages = snapshot.val();\r\n      if (messages) {\r\n        // Get the latest message\r\n        const messageKeys = Object.keys(messages).sort();\r\n        const latestKey = messageKeys[messageKeys.length - 1];\r\n        const latestMessage = messages[latestKey];\r\n        \r\n        if (latestMessage) {\r\n          callback(latestMessage as StreamMessage);\r\n        }\r\n      }\r\n    });\r\n\r\n    const listenerId = `messages_${sessionId}`;\r\n    this.listeners.set(listenerId, unsubscribe);\r\n\r\n    return () => {\r\n      off(messagesRef, 'value', unsubscribe);\r\n      this.listeners.delete(listenerId);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get generation status\r\n   */\r\n  async getGenerationStatus(sessionId: string): Promise<GenerationProgress | null> {\r\n    return new Promise((resolve) => {\r\n      const sessionRef = ref(this.database, `generations/${sessionId}`);\r\n      \r\n      onValue(sessionRef, (snapshot) => {\r\n        const data = snapshot.val();\r\n        resolve(data as GenerationProgress | null);\r\n      }, { onlyOnce: true });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clean up old generation sessions\r\n   */\r\n  async cleanupOldSessions(maxAgeHours: number = 24): Promise<void> {\r\n    const cutoffTime = Date.now() - (maxAgeHours * 60 * 60 * 1000);\r\n    \r\n    // This would typically be done via Firebase Functions\r\n    // For now, we'll just note that cleanup should be implemented server-side\r\n    console.log(`Cleanup sessions older than ${cutoffTime}`);\r\n  }\r\n\r\n  /**\r\n   * Disconnect all listeners\r\n   */\r\n  disconnectAll(): void {\r\n    this.listeners.forEach((unsubscribe) => {\r\n      unsubscribe();\r\n    });\r\n    this.listeners.clear();\r\n  }\r\n\r\n  /**\r\n   * Stream AI generation with live file updates\r\n   */\r\n  async streamGeneration(\r\n    sessionId: string,\r\n    userId: string,\r\n    onProgress: (progress: GenerationProgress) => void,\r\n    onMessage: (message: StreamMessage) => void\r\n  ): Promise<void> {\r\n    // Start the session\r\n    await this.startGenerationSession(sessionId, userId);\r\n\r\n    // Subscribe to progress updates\r\n    const unsubscribeProgress = this.subscribeToGeneration(sessionId, onProgress);\r\n    \r\n    // Subscribe to messages\r\n    const unsubscribeMessages = this.subscribeToMessages(sessionId, onMessage);\r\n\r\n    // Simulate AI generation process with real-time updates\r\n    try {\r\n      // Step 1: Analyzing\r\n      await this.updateProgress(sessionId, 'analyzing', 10, 'Analyzing requirements...');\r\n      await this.sendMessage(sessionId, {\r\n        type: 'progress',\r\n        data: { step: 'analyzing', message: 'Breaking down your requirements...' },\r\n        timestamp: Date.now(),\r\n      });\r\n\r\n      // Simulate delay\r\n      await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n      // Step 2: Generating\r\n      await this.updateProgress(sessionId, 'generating', 30, 'Generating code structure...');\r\n      await this.sendMessage(sessionId, {\r\n        type: 'progress',\r\n        data: { step: 'generating', message: 'Creating project structure...' },\r\n        timestamp: Date.now(),\r\n      });\r\n\r\n      // Simulate file generation\r\n      const files = [\r\n        {\r\n          name: 'package.json',\r\n          path: '/package.json',\r\n          content: JSON.stringify({ name: 'generated-app', version: '1.0.0' }, null, 2),\r\n          language: 'json',\r\n        },\r\n        {\r\n          name: 'index.html',\r\n          path: '/index.html',\r\n          content: '<!DOCTYPE html><html><head><title>Generated App</title></head><body><h1>Hello World</h1></body></html>',\r\n          language: 'html',\r\n        },\r\n      ];\r\n\r\n      for (let i = 0; i < files.length; i++) {\r\n        const file = files[i];\r\n        const progress = 30 + (i + 1) * 20;\r\n        \r\n        await this.updateProgress(\r\n          sessionId, \r\n          'generating', \r\n          progress, \r\n          `Generating ${file.name}...`,\r\n          files.slice(0, i + 1)\r\n        );\r\n        \r\n        await this.sendMessage(sessionId, {\r\n          type: 'file',\r\n          data: file,\r\n          timestamp: Date.now(),\r\n        });\r\n\r\n        // Simulate generation time\r\n        await new Promise(resolve => setTimeout(resolve, 1500));\r\n      }\r\n\r\n      // Step 3: Reviewing\r\n      await this.updateProgress(sessionId, 'reviewing', 80, 'Reviewing generated code...');\r\n      await this.sendMessage(sessionId, {\r\n        type: 'progress',\r\n        data: { step: 'reviewing', message: 'Optimizing and reviewing code quality...' },\r\n        timestamp: Date.now(),\r\n      });\r\n\r\n      await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n      // Step 4: Complete\r\n      await this.completeGeneration(sessionId, files);\r\n      await this.sendMessage(sessionId, {\r\n        type: 'complete',\r\n        data: { files, message: 'Generation completed successfully!' },\r\n        timestamp: Date.now(),\r\n      });\r\n\r\n    } catch (error) {\r\n      await this.errorGeneration(sessionId, error instanceof Error ? error.message : 'Unknown error');\r\n      await this.sendMessage(sessionId, {\r\n        type: 'error',\r\n        data: { error: error instanceof Error ? error.message : 'Unknown error' },\r\n        timestamp: Date.now(),\r\n      });\r\n    } finally {\r\n      // Cleanup listeners after completion\r\n      setTimeout(() => {\r\n        unsubscribeProgress();\r\n        unsubscribeMessages();\r\n      }, 10000); // Keep alive for 10 seconds after completion\r\n    }\r\n  }\r\n}","/**\r\n * Real-time Generation Component\r\n * Demonstrates live AI generation with real-time progress updates\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { useRealtimeGeneration } from '@/hooks/useRealtimeGeneration';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { \r\n  Play, \r\n  Square, \r\n  Trash2, \r\n  Clock, \r\n  CheckCircle, \r\n  XCircle, \r\n  Code, \r\n  FileText,\r\n  Loader2 \r\n} from 'lucide-react';\r\n\r\nexport function RealtimeGeneration() {\r\n  const { user } = useAuth();\r\n  const {\r\n    isGenerating,\r\n    progress,\r\n    messages,\r\n    error,\r\n    startGeneration,\r\n    stopGeneration,\r\n    clearGeneration,\r\n  } = useRealtimeGeneration();\r\n\r\n  const [sessionId, setSessionId] = useState<string | null>(null);\r\n\r\n  /**\r\n   * Start a new generation\r\n   */\r\n  const handleStartGeneration = async () => {\r\n    if (!user) {\r\n      alert('Please login to start generation');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const newSessionId = await startGeneration(user.uid);\r\n      setSessionId(newSessionId);\r\n    } catch (error) {\r\n      console.error('Failed to start generation:', error);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Stop current generation\r\n   */\r\n  const handleStopGeneration = () => {\r\n    stopGeneration();\r\n  };\r\n\r\n  /**\r\n   * Clear generation results\r\n   */\r\n  const handleClearGeneration = () => {\r\n    clearGeneration();\r\n    setSessionId(null);\r\n  };\r\n\r\n  /**\r\n   * Get status badge\r\n   */\r\n  const getStatusBadge = () => {\r\n    if (!progress) return null;\r\n\r\n    const statusConfig = {\r\n      initializing: { variant: 'secondary' as const, icon: Clock, text: 'Initializing' },\r\n      analyzing: { variant: 'default' as const, icon: Loader2, text: 'Analyzing' },\r\n      generating: { variant: 'default' as const, icon: Code, text: 'Generating' },\r\n      reviewing: { variant: 'default' as const, icon: FileText, text: 'Reviewing' },\r\n      completed: { variant: 'default' as const, icon: CheckCircle, text: 'Completed' },\r\n      error: { variant: 'destructive' as const, icon: XCircle, text: 'Error' },\r\n    };\r\n\r\n    const config = statusConfig[progress.status];\r\n    const Icon = config.icon;\r\n\r\n    return (\r\n      <Badge variant={config.variant} className=\"flex items-center space-x-1\">\r\n        <Icon className={`h-3 w-3 ${progress.status === 'analyzing' || progress.status === 'generating' ? 'animate-spin' : ''}`} />\r\n        <span>{config.text}</span>\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mx-auto p-6 space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center justify-between\">\r\n            <span>Real-time AI Generation</span>\r\n            <div className=\"flex items-center space-x-2\">\r\n              {getStatusBadge()}\r\n              {sessionId && (\r\n                <Badge variant=\"outline\" className=\"font-mono text-xs\">\r\n                  {sessionId}\r\n                </Badge>\r\n              )}\r\n            </div>\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <p className=\"text-muted-foreground\">\r\n            This demonstrates real-time AI generation with live progress updates using Firebase Realtime Database.\r\n          </p>\r\n\r\n          {/* Control Buttons */}\r\n          <div className=\"flex space-x-2\">\r\n            <Button\r\n              onClick={handleStartGeneration}\r\n              disabled={isGenerating || !user}\r\n              className=\"flex items-center space-x-2\"\r\n            >\r\n              <Play className=\"h-4 w-4\" />\r\n              <span>Start Generation</span>\r\n            </Button>\r\n\r\n            {isGenerating && (\r\n              <Button\r\n                variant=\"destructive\"\r\n                onClick={handleStopGeneration}\r\n                className=\"flex items-center space-x-2\"\r\n              >\r\n                <Square className=\"h-4 w-4\" />\r\n                <span>Stop</span>\r\n              </Button>\r\n            )}\r\n\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={handleClearGeneration}\r\n              className=\"flex items-center space-x-2\"\r\n            >\r\n              <Trash2 className=\"h-4 w-4\" />\r\n              <span>Clear</span>\r\n            </Button>\r\n          </div>\r\n\r\n          {/* Progress Display */}\r\n          {progress && (\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between text-sm\">\r\n                <span className=\"font-medium\">{progress.currentStep}</span>\r\n                <span className=\"text-muted-foreground\">{progress.progress}%</span>\r\n              </div>\r\n              <Progress value={progress.progress} className=\"w-full\" />\r\n            </div>\r\n          )}\r\n\r\n          {/* Error Display */}\r\n          {error && (\r\n            <Card className=\"border-destructive\">\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-destructive text-sm\">Error</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <pre className=\"text-sm text-destructive whitespace-pre-wrap\">\r\n                  {error}\r\n                </pre>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Generated Files */}\r\n      {progress?.files && progress.files.length > 0 && (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Generated Files ({progress.files.length})</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-4\">\r\n              {progress.files.map((file, index) => (\r\n                <Card key={index} className=\"border\">\r\n                  <CardHeader className=\"pb-2\">\r\n                    <CardTitle className=\"text-sm flex items-center space-x-2\">\r\n                      <Code className=\"h-4 w-4\" />\r\n                      <span className=\"font-mono\">{file.name}</span>\r\n                      <Badge variant=\"outline\" className=\"text-xs\">\r\n                        {file.language}\r\n                      </Badge>\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <ScrollArea className=\"h-32 w-full\">\r\n                      <pre className=\"text-xs font-mono whitespace-pre-wrap bg-muted p-2 rounded\">\r\n                        {file.content}\r\n                      </pre>\r\n                    </ScrollArea>\r\n                  </CardContent>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Real-time Messages */}\r\n      {messages.length > 0 && (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Live Updates ({messages.length})</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <ScrollArea className=\"h-64 w-full\">\r\n              <div className=\"space-y-2\">\r\n                {messages.map((message, index) => (\r\n                  <div key={index} className=\"flex items-start space-x-2 p-2 bg-muted/50 rounded\">\r\n                    <Badge variant=\"outline\" className=\"text-xs\">\r\n                      {message.type}\r\n                    </Badge>\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"text-sm\">\r\n                        {message.type === 'file' ? (\r\n                          <span className=\"font-mono\">{message.data.name}</span>\r\n                        ) : (\r\n                          <span>{message.data.message || JSON.stringify(message.data)}</span>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"text-xs text-muted-foreground\">\r\n                        {new Date(message.timestamp).toLocaleTimeString()}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </ScrollArea>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Auth Notice */}\r\n      {!user && (\r\n        <Card className=\"border-yellow-200 bg-yellow-50\">\r\n          <CardHeader>\r\n            <CardTitle className=\"text-yellow-800\">Authentication Required</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-yellow-700\">\r\n              Please login to test the real-time generation features.\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n}","/**\r\n * Real-time Generation Hook\r\n * React hook for managing real-time AI generation with live updates\r\n */\r\n\r\nimport { useState, useCallback, useRef, useEffect } from 'react';\r\nimport { RealtimeService, GenerationProgress, StreamMessage } from '@/services/RealtimeService';\r\n\r\ninterface GenerationState {\r\n  isGenerating: boolean;\r\n  progress: GenerationProgress | null;\r\n  messages: StreamMessage[];\r\n  error: string | null;\r\n}\r\n\r\nexport const useRealtimeGeneration = () => {\r\n  const [state, setState] = useState<GenerationState>({\r\n    isGenerating: false,\r\n    progress: null,\r\n    messages: [],\r\n    error: null,\r\n  });\r\n\r\n  const realtimeService = RealtimeService.getInstance();\r\n  const unsubscribeRefs = useRef<(() => void)[]>([]);\r\n\r\n  /**\r\n   * Start a new generation session with real-time updates\r\n   */\r\n  const startGeneration = useCallback(async (userId: string): Promise<string> => {\r\n    const sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n    setState(prev => ({\r\n      ...prev,\r\n      isGenerating: true,\r\n      progress: null,\r\n      messages: [],\r\n      error: null,\r\n    }));\r\n\r\n    try {\r\n      // Set up real-time listeners\r\n      const unsubscribeProgress = realtimeService.subscribeToGeneration(sessionId, (progress) => {\r\n        setState(prev => ({\r\n          ...prev,\r\n          progress,\r\n          error: progress.error || null,\r\n        }));\r\n\r\n        // If generation is complete or has error, stop generating\r\n        if (progress.status === 'completed' || progress.status === 'error') {\r\n          setState(prev => ({\r\n            ...prev,\r\n            isGenerating: false,\r\n          }));\r\n        }\r\n      });\r\n\r\n      const unsubscribeMessages = realtimeService.subscribeToMessages(sessionId, (message) => {\r\n        setState(prev => ({\r\n          ...prev,\r\n          messages: [...prev.messages, message],\r\n        }));\r\n      });\r\n\r\n      // Store unsubscribe functions\r\n      unsubscribeRefs.current = [unsubscribeProgress, unsubscribeMessages];\r\n\r\n      // Start the generation stream\r\n      await realtimeService.streamGeneration(\r\n        sessionId,\r\n        userId,\r\n        (progress) => {\r\n          console.log('Progress update:', progress);\r\n        },\r\n        (message) => {\r\n          console.log('Message received:', message);\r\n        }\r\n      );\r\n\r\n      return sessionId;\r\n    } catch (error) {\r\n      setState(prev => ({\r\n        ...prev,\r\n        isGenerating: false,\r\n        error: error instanceof Error ? error.message : 'Generation failed',\r\n      }));\r\n      throw error;\r\n    }\r\n  }, [realtimeService]);\r\n\r\n  /**\r\n   * Stop the current generation\r\n   */\r\n  const stopGeneration = useCallback(() => {\r\n    // Unsubscribe from all listeners\r\n    unsubscribeRefs.current.forEach(unsubscribe => unsubscribe());\r\n    unsubscribeRefs.current = [];\r\n\r\n    setState(prev => ({\r\n      ...prev,\r\n      isGenerating: false,\r\n    }));\r\n  }, []);\r\n\r\n  /**\r\n   * Clear generation state\r\n   */\r\n  const clearGeneration = useCallback(() => {\r\n    setState({\r\n      isGenerating: false,\r\n      progress: null,\r\n      messages: [],\r\n      error: null,\r\n    });\r\n  }, []);\r\n\r\n  /**\r\n   * Get generation status by session ID\r\n   */\r\n  const getGenerationStatus = useCallback(async (sessionId: string): Promise<GenerationProgress | null> => {\r\n    return await realtimeService.getGenerationStatus(sessionId);\r\n  }, [realtimeService]);\r\n\r\n  /**\r\n   * Resume watching an existing generation session\r\n   */\r\n  const resumeGeneration = useCallback((sessionId: string) => {\r\n    setState(prev => ({\r\n      ...prev,\r\n      isGenerating: true,\r\n      error: null,\r\n    }));\r\n\r\n    const unsubscribeProgress = realtimeService.subscribeToGeneration(sessionId, (progress) => {\r\n      setState(prev => ({\r\n        ...prev,\r\n        progress,\r\n        error: progress.error || null,\r\n      }));\r\n\r\n      if (progress.status === 'completed' || progress.status === 'error') {\r\n        setState(prev => ({\r\n          ...prev,\r\n          isGenerating: false,\r\n        }));\r\n      }\r\n    });\r\n\r\n    const unsubscribeMessages = realtimeService.subscribeToMessages(sessionId, (message) => {\r\n      setState(prev => ({\r\n        ...prev,\r\n        messages: [...prev.messages, message],\r\n      }));\r\n    });\r\n\r\n    unsubscribeRefs.current = [unsubscribeProgress, unsubscribeMessages];\r\n  }, [realtimeService]);\r\n\r\n  // Cleanup on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      unsubscribeRefs.current.forEach(unsubscribe => unsubscribe());\r\n      realtimeService.disconnectAll();\r\n    };\r\n  }, [realtimeService]);\r\n\r\n  return {\r\n    ...state,\r\n    startGeneration,\r\n    stopGeneration,\r\n    clearGeneration,\r\n    getGenerationStatus,\r\n    resumeGeneration,\r\n  };\r\n};"],"names":["Progress","React.forwardRef","className","value","max","props","ref","percentage","Math","min","jsx","cn","children","style","width","displayName","_RealtimeService","constructor","__publicField","this","getDatabase","app","Map","getInstance","instance","startGenerationSession","sessionId","userId","sessionRef","database","initialProgress","status","progress","currentStep","timestamp","Date","now","set","createdAt","serverTimestamp","updateProgress","files","update","updatedAt","completeGeneration","errorGeneration","error","subscribeToGeneration","callback","unsubscribe","onValue","snapshot","data","val","listeners","off","delete","sendMessage","message","messageRef","subscribeToMessages","messagesRef","messages","messageKeys","Object","keys","sort","latestMessage","length","listenerId","getGenerationStatus","Promise","resolve","onlyOnce","cleanupOldSessions","maxAgeHours","disconnectAll","forEach","clear","streamGeneration","onProgress","onMessage","unsubscribeProgress","unsubscribeMessages","type","step","setTimeout","name","path","content","JSON","stringify","version","language","i","file","slice","Error","RealtimeService","RealtimeGeneration","user","useAuth","isGenerating","startGeneration","stopGeneration","clearGeneration","state","setState","useState","realtimeService","unsubscribeRefs","useRef","useCallback","async","random","toString","substr","prev","current","resumeGeneration","useEffect","useRealtimeGeneration","setSessionId","jsxs","Card","CardHeader","CardTitle","config","initializing","variant","icon","Clock","text","analyzing","Loader2","generating","Code","reviewing","FileText","completed","CheckCircle","XCircle","Icon","Badge","getStatusBadge","CardContent","Button","onClick","newSessionId","uid","alert","disabled","Play","Square","Trash2","map","index","ScrollArea","toLocaleTimeString"],"mappings":"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"}
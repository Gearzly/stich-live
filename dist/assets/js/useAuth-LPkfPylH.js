import{r}from"./router-BzeIgkns.js";import{x as e,E as a,r as s,o,y as t,z as i,D as n,B as l,G as u,A as c,n as d,C as g}from"./firebase-rW0Qch21.js";import{U as w,e as f}from"./index-DEqFfg-I.js";function h(){const[h,y]=r.useState({user:null,loading:!0,error:null}),m=new w;r.useEffect(()=>{const r=e(f,async r=>{if(r)try{const e=await m.getUserProfile(r.uid),a={...r,...e&&{profile:e}};y({user:a,loading:!1,error:null})}catch(e){y({user:{...r},loading:!1,error:"Failed to load user profile"})}else y({user:null,loading:!1,error:null})});return()=>r()},[]);const p=!!h.user,P=!!h.user?.profile;return{user:h.user,loading:h.loading,error:h.error,isAuthenticated:p,hasProfile:P,signInWithEmail:async r=>{try{y(r=>({...r,loading:!0,error:null}));const e=await g(f,r.email,r.password),a=await m.getUserProfile(e.user.uid),s={...e.user,...a&&{profile:a}};return y({user:s,loading:!1,error:null}),s}catch(e){throw y(r=>({...r,loading:!1,error:e.message||"Login failed"})),e}},register:async r=>{try{y(r=>({...r,loading:!0,error:null}));const e=await c(f,r.email,r.password);await d(e.user,{displayName:r.displayName});const a=await m.createUserProfile(e.user),s={...e.user,...a&&{profile:a}};return y({user:s,loading:!1,error:null}),s}catch(e){throw y(r=>({...r,loading:!1,error:e.message||"Registration failed"})),e}},signInWithGoogle:async()=>{try{y(r=>({...r,loading:!0,error:null}));const r=new u,e=await l(f,r);let a=await m.getUserProfile(e.user.uid);a||(a=await m.createUserProfile(e.user));const s={...e.user,...a&&{profile:a}};return y({user:s,loading:!1,error:null}),s}catch(r){throw y(e=>({...e,loading:!1,error:r.message||"Google sign-in failed"})),r}},signInWithGitHub:async()=>{try{y(r=>({...r,loading:!0,error:null}));const r=new n,e=await l(f,r);let a=await m.getUserProfile(e.user.uid);a||(a=await m.createUserProfile(e.user));const s={...e.user,...a&&{profile:a}};return y({user:s,loading:!1,error:null}),s}catch(r){throw y(e=>({...e,loading:!1,error:r.message||"GitHub sign-in failed"})),r}},signOut:async()=>{try{await i(f),y({user:null,loading:!1,error:null})}catch(r){throw y(e=>({...e,error:r.message||"Sign out failed"})),r}},resetPassword:async r=>{try{await t(f,r)}catch(e){throw new Error(e.message||"Password reset failed")}},changePassword:async(r,e)=>{try{if(!h.user)throw new Error("No authenticated user");const t=a.credential(h.user.email,r);await s(h.user,t),await o(h.user,e)}catch(t){throw new Error(t.message||"Password update failed")}},refreshProfile:async()=>{try{if(!h.user)return;const r=await m.getUserProfile(h.user.uid);return y(e=>({...e,user:e.user?{...e.user,...r&&{profile:r}}:null})),r}catch(r){throw r}},clearError:()=>y(r=>({...r,error:null}))}}export{h as u};
//# sourceMappingURL=useAuth-LPkfPylH.js.map

var e=Object.defineProperty,s=(s,t,a)=>((s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a)(s,"symbol"!=typeof t?t+"":t,a);import{j as t}from"./ui-Ct5cQbGm.js";import{r as a}from"./router-BzeIgkns.js";import{k as n,u as r,C as i,a as l,b as o,d as c,B as d}from"./index-DNzaZn5L.js";import{P as m}from"./progress-CXiz3fB1.js";import{B as u}from"./badge-Do-isio7.js";import{S as g}from"./scroll-area-DUzSH_QX.js";import{c as p,F as h,H as x,I as j,J as w,K as f}from"./firebase-rW0Qch21.js";import{P as b,w as y,K as v,c as N,C as G,a as S,Q as P,x as k,r as D}from"./icons-Cz8iQkUU.js";import"./vendor-DEQ385Nk.js";import"./utils-Bmne0XXo.js";import"./index-jVOyRz7F.js";const T=class e{constructor(){s(this,"database",p(n)),s(this,"listeners",new Map)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async startGenerationSession(e,s){const t=h(this.database,`generations/${e}`),a={sessionId:e,userId:s,status:"initializing",progress:0,currentStep:"Starting AI generation...",timestamp:Date.now()};await x(t,{...a,createdAt:f()})}async updateProgress(e,s,t,a,n){const r=h(this.database,`generations/${e}`),i={status:s,progress:t,currentStep:a,timestamp:Date.now()};n&&(i.files=n),await x(r,{...i,updatedAt:f()})}async completeGeneration(e,s){await this.updateProgress(e,"completed",100,"Generation completed successfully",s)}async errorGeneration(e,s){const t=h(this.database,`generations/${e}`);await x(t,{status:"error",progress:0,currentStep:"Generation failed",error:s,timestamp:Date.now(),updatedAt:f()})}subscribeToGeneration(e,s){const t=h(this.database,`generations/${e}`),a=j(t,e=>{const t=e.val();t&&s(t)});return this.listeners.set(e,a),()=>{w(t,"value",a),this.listeners.delete(e)}}async sendMessage(e,s){const t=h(this.database,`messages/${e}/${Date.now()}`);await x(t,{...s,createdAt:f()})}subscribeToMessages(e,s){const t=h(this.database,`messages/${e}`),a=j(t,e=>{const t=e.val();if(t){const e=Object.keys(t).sort(),a=t[e[e.length-1]];a&&s(a)}}),n=`messages_${e}`;return this.listeners.set(n,a),()=>{w(t,"value",a),this.listeners.delete(n)}}async getGenerationStatus(e){return new Promise(s=>{const t=h(this.database,`generations/${e}`);j(t,e=>{const t=e.val();s(t)},{onlyOnce:!0})})}async cleanupOldSessions(e=24){Date.now()}disconnectAll(){this.listeners.forEach(e=>{e()}),this.listeners.clear()}async streamGeneration(e,s,t,a){await this.startGenerationSession(e,s);const n=this.subscribeToGeneration(e,t),r=this.subscribeToMessages(e,a);try{await this.updateProgress(e,"analyzing",10,"Analyzing requirements..."),await this.sendMessage(e,{type:"progress",data:{step:"analyzing",message:"Breaking down your requirements..."},timestamp:Date.now()}),await new Promise(e=>setTimeout(e,2e3)),await this.updateProgress(e,"generating",30,"Generating code structure..."),await this.sendMessage(e,{type:"progress",data:{step:"generating",message:"Creating project structure..."},timestamp:Date.now()});const s=[{name:"package.json",path:"/package.json",content:JSON.stringify({name:"generated-app",version:"1.0.0"},null,2),language:"json"},{name:"index.html",path:"/index.html",content:"<!DOCTYPE html><html><head><title>Generated App</title></head><body><h1>Hello World</h1></body></html>",language:"html"}];for(let t=0;t<s.length;t++){const a=s[t],n=30+20*(t+1);await this.updateProgress(e,"generating",n,`Generating ${a.name}...`,s.slice(0,t+1)),await this.sendMessage(e,{type:"file",data:a,timestamp:Date.now()}),await new Promise(e=>setTimeout(e,1500))}await this.updateProgress(e,"reviewing",80,"Reviewing generated code..."),await this.sendMessage(e,{type:"progress",data:{step:"reviewing",message:"Optimizing and reviewing code quality..."},timestamp:Date.now()}),await new Promise(e=>setTimeout(e,2e3)),await this.completeGeneration(e,s),await this.sendMessage(e,{type:"complete",data:{files:s,message:"Generation completed successfully!"},timestamp:Date.now()})}catch(i){await this.errorGeneration(e,i instanceof Error?i.message:"Unknown error"),await this.sendMessage(e,{type:"error",data:{error:i instanceof Error?i.message:"Unknown error"},timestamp:Date.now()})}finally{setTimeout(()=>{n(),r()},1e4)}}};s(T,"instance");let C=T;function A(){const{user:e}=r(),{isGenerating:s,progress:n,messages:p,error:h,startGeneration:x,stopGeneration:j,clearGeneration:w}=(()=>{const[e,s]=a.useState({isGenerating:!1,progress:null,messages:[],error:null}),t=C.getInstance(),n=a.useRef([]),r=a.useCallback(async e=>{const a=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;s(e=>({...e,isGenerating:!0,progress:null,messages:[],error:null}));try{const r=t.subscribeToGeneration(a,e=>{s(s=>({...s,progress:e,error:e.error||null})),"completed"!==e.status&&"error"!==e.status||s(e=>({...e,isGenerating:!1}))}),i=t.subscribeToMessages(a,e=>{s(s=>({...s,messages:[...s.messages,e]}))});return n.current=[r,i],await t.streamGeneration(a,e,e=>{},e=>{}),a}catch(h){throw s(s=>({...s,isGenerating:!1,error:h instanceof Error?h.message:"Generation failed"})),h}},[t]),i=a.useCallback(()=>{n.current.forEach(e=>e()),n.current=[],s(e=>({...e,isGenerating:!1}))},[]),l=a.useCallback(()=>{s({isGenerating:!1,progress:null,messages:[],error:null})},[]),o=a.useCallback(async e=>await t.getGenerationStatus(e),[t]),c=a.useCallback(e=>{s(e=>({...e,isGenerating:!0,error:null}));const a=t.subscribeToGeneration(e,e=>{s(s=>({...s,progress:e,error:e.error||null})),"completed"!==e.status&&"error"!==e.status||s(e=>({...e,isGenerating:!1}))}),r=t.subscribeToMessages(e,e=>{s(s=>({...s,messages:[...s.messages,e]}))});n.current=[a,r]},[t]);return a.useEffect(()=>()=>{n.current.forEach(e=>e()),t.disconnectAll()},[t]),{...e,startGeneration:r,stopGeneration:i,clearGeneration:l,getGenerationStatus:o,resumeGeneration:c}})(),[f,T]=a.useState(null);return t.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[t.jsxs(i,{children:[t.jsx(l,{children:t.jsxs(o,{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Real-time AI Generation"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[(()=>{if(!n)return null;const e={initializing:{variant:"secondary",icon:D,text:"Initializing"},analyzing:{variant:"default",icon:k,text:"Analyzing"},generating:{variant:"default",icon:N,text:"Generating"},reviewing:{variant:"default",icon:P,text:"Reviewing"},completed:{variant:"default",icon:S,text:"Completed"},error:{variant:"destructive",icon:G,text:"Error"}}[n.status],s=e.icon;return t.jsxs(u,{variant:e.variant,className:"flex items-center space-x-1",children:[t.jsx(s,{className:"h-3 w-3 "+("analyzing"===n.status||"generating"===n.status?"animate-spin":"")}),t.jsx("span",{children:e.text})]})})(),f&&t.jsx(u,{variant:"outline",className:"font-mono text-xs",children:f})]})]})}),t.jsxs(c,{className:"space-y-4",children:[t.jsx("p",{className:"text-muted-foreground",children:"This demonstrates real-time AI generation with live progress updates using Firebase Realtime Database."}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs(d,{onClick:async()=>{if(e)try{const s=await x(e.uid);T(s)}catch(s){}else alert("Please login to start generation")},disabled:s||!e,className:"flex items-center space-x-2",children:[t.jsx(b,{className:"h-4 w-4"}),t.jsx("span",{children:"Start Generation"})]}),s&&t.jsxs(d,{variant:"destructive",onClick:()=>{j()},className:"flex items-center space-x-2",children:[t.jsx(y,{className:"h-4 w-4"}),t.jsx("span",{children:"Stop"})]}),t.jsxs(d,{variant:"outline",onClick:()=>{w(),T(null)},className:"flex items-center space-x-2",children:[t.jsx(v,{className:"h-4 w-4"}),t.jsx("span",{children:"Clear"})]})]}),n&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"font-medium",children:n.currentStep}),t.jsxs("span",{className:"text-muted-foreground",children:[n.progress,"%"]})]}),t.jsx(m,{value:n.progress,className:"w-full"})]}),h&&t.jsxs(i,{className:"border-destructive",children:[t.jsx(l,{className:"pb-2",children:t.jsx(o,{className:"text-destructive text-sm",children:"Error"})}),t.jsx(c,{children:t.jsx("pre",{className:"text-sm text-destructive whitespace-pre-wrap",children:h})})]})]})]}),n?.files&&n.files.length>0&&t.jsxs(i,{children:[t.jsx(l,{children:t.jsxs(o,{children:["Generated Files (",n.files.length,")"]})}),t.jsx(c,{children:t.jsx("div",{className:"space-y-4",children:n.files.map((e,s)=>t.jsxs(i,{className:"border",children:[t.jsx(l,{className:"pb-2",children:t.jsxs(o,{className:"text-sm flex items-center space-x-2",children:[t.jsx(N,{className:"h-4 w-4"}),t.jsx("span",{className:"font-mono",children:e.name}),t.jsx(u,{variant:"outline",className:"text-xs",children:e.language})]})}),t.jsx(c,{children:t.jsx(g,{className:"h-32 w-full",children:t.jsx("pre",{className:"text-xs font-mono whitespace-pre-wrap bg-muted p-2 rounded",children:e.content})})})]},s))})})]}),p.length>0&&t.jsxs(i,{children:[t.jsx(l,{children:t.jsxs(o,{children:["Live Updates (",p.length,")"]})}),t.jsx(c,{children:t.jsx(g,{className:"h-64 w-full",children:t.jsx("div",{className:"space-y-2",children:p.map((e,s)=>t.jsxs("div",{className:"flex items-start space-x-2 p-2 bg-muted/50 rounded",children:[t.jsx(u,{variant:"outline",className:"text-xs",children:e.type}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm",children:"file"===e.type?t.jsx("span",{className:"font-mono",children:e.data.name}):t.jsx("span",{children:e.data.message||JSON.stringify(e.data)})}),t.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(e.timestamp).toLocaleTimeString()})]})]},s))})})})]}),!e&&t.jsxs(i,{className:"border-yellow-200 bg-yellow-50",children:[t.jsx(l,{children:t.jsx(o,{className:"text-yellow-800",children:"Authentication Required"})}),t.jsx(c,{children:t.jsx("p",{className:"text-yellow-700",children:"Please login to test the real-time generation features."})})]})]})}export{A as RealtimeGeneration};
//# sourceMappingURL=RealtimeGeneration-CFKL2DG7.js.map

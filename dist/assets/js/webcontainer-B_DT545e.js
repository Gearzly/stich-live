var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);(new Error).stack="";const n={};let r=null;const s={get editorOrigin(){return null==r&&(r=new URL(globalThis.WEBCONTAINER_API_IFRAME_URL??"https://stackblitz.com").origin),r},set editorOrigin(e){r=new URL(e).origin},setQueryParam(e,t){n[e]=t},get url(){const e=new URL(this.editorOrigin);e.pathname="/headless";for(const t in n)e.searchParams.set(t,n[t]);return e.searchParams.set("version","1.6.1"),e}};var i,a;(function(){let e,t;function n(){t=new Promise(t=>e=t)}n()})(),(a=i||(i={})).UncaughtException="PREVIEW_UNCAUGHT_EXCEPTION",a.UnhandledRejection="PREVIEW_UNHANDLED_REJECTION",a.ConsoleError="PREVIEW_CONSOLE_ERROR";var o=Object.defineProperty,c={};((e,t)=>{for(var n in t)o(e,n,{get:t[n],enumerable:!0})})(c,{createEndpoint:()=>u,expose:()=>w,proxy:()=>P,proxyMarker:()=>l,releaseProxy:()=>h,transfer:()=>E,transferHandlers:()=>p,windowEndpoint:()=>x,wrap:()=>y});var l=Symbol("Comlink.proxy"),u=Symbol("Comlink.endpoint"),h=Symbol("Comlink.releaseProxy"),f=Symbol("Comlink.thrown"),d=e=>"object"==typeof e&&null!==e||"function"==typeof e,p=new Map([["proxy",{canHandle:e=>d(e)&&e[l],serialize(e){const{port1:t,port2:n}=new MessageChannel;return w(e,t),[n,[n]]},deserialize:e=>(e.start(),y(e))}],["throw",{canHandle:e=>d(e)&&f in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function w(e,t=self){t.addEventListener("message",function n(r){if(!r||!r.data)return;const{id:s,type:i,path:a}=Object.assign({path:[]},r.data),o=(r.data.argumentList||[]).map(O);let c;try{const t=a.slice(0,-1).reduce((e,t)=>e[t],e),n=a.reduce((e,t)=>e[t],e);switch(i){case 0:c=n;break;case 1:t[a.slice(-1)[0]]=O(r.data.value),c=!0;break;case 2:c=n.apply(t,o);break;case 3:c=P(new n(...o));break;case 4:{const{port1:t,port2:n}=new MessageChannel;w(e,n),c=E(t,[t])}break;case 5:c=void 0}}catch(l){c={value:l,[f]:0}}Promise.resolve(c).catch(e=>({value:e,[f]:0})).then(e=>{const[r,a]=k(e);t.postMessage(Object.assign(Object.assign({},r),{id:s}),a),5===i&&(t.removeEventListener("message",n),m(t))})}),t.start&&t.start()}function m(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function y(e,t){return g(e,[],t)}function _(e){if(e)throw new Error("Proxy has been released and is not useable")}function g(e,t=[],n=function(){}){let r=!1;const s=new Proxy(n,{get(n,i){if(_(r),i===h)return()=>L(e,{type:5,path:t.map(e=>e.toString())}).then(()=>{m(e),r=!0});if("then"===i){if(0===t.length)return{then:()=>s};const n=L(e,{type:0,path:t.map(e=>e.toString())}).then(O);return n.then.bind(n)}return g(e,[...t,i])},set(n,s,i){_(r);const[a,o]=k(i);return L(e,{type:1,path:[...t,s].map(e=>e.toString()),value:a},o).then(O)},apply(n,s,i){_(r);const a=t[t.length-1];if(a===u)return L(e,{type:4}).then(O);if("bind"===a)return g(e,t.slice(0,-1));const[o,c]=b(i);return L(e,{type:2,path:t.map(e=>e.toString()),argumentList:o},c).then(O)},construct(n,s){_(r);const[i,a]=b(s);return L(e,{type:3,path:t.map(e=>e.toString()),argumentList:i},a).then(O)}});return s}function b(e){const t=e.map(k);return[t.map(e=>e[0]),(n=t.map(e=>e[1]),Array.prototype.concat.apply([],n))];var n}var v=new WeakMap;function E(e,t){return v.set(e,t),e}function P(e){return Object.assign(e,{[l]:!0})}function x(e,t=self,n="*"){return{postMessage:(t,r)=>e.postMessage(t,n,r),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}}function k(e){for(const[t,n]of p)if(n.canHandle(e)){const[r,s]=n.serialize(e);return[{type:3,name:t,value:r},s]}return[{type:0,value:e},v.get(e)||[]]}function O(e){switch(e.type){case 3:return p.get(e.name).deserialize(e.value);case 0:return e.value}}function L(e,t,n){return new Promise(r=>{const s=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");e.addEventListener("message",function t(n){n.data&&n.data.id&&n.data.id===s&&(e.removeEventListener("message",t),r(n.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),n)})}const S=[i.ConsoleError,i.UncaughtException,i.UnhandledRejection];function C(e){const t=Object.create(null);return e?Object.assign(t,e):t}const A=new TextDecoder("latin1");function j(e){const t={d:{}};for(const n of Object.keys(e)){const r=e[n];if("file"in r){if("symlink"in r.file){t.d[n]={f:{l:r.file.symlink}};continue}const e=r.file.contents,s="string"==typeof e?e:A.decode(e),i="string"==typeof e?{}:{b:!0};t.d[n]={f:{c:s,...i}};continue}const s=j(r.directory);t.d[n]=s}return t}function N(e){const t=C();if("f"in e)throw new Error("It is not possible to export a single file in the JSON format.");if("d"in e)for(const n of Object.keys(e.d)){const r=e.d[n];"d"in r?t[n]=C({directory:N(r)}):"f"in r&&("c"in r.f?t[n]=C({file:C({contents:r.f.b?R(r.f.c):r.f.c})}):"l"in r.f&&(t[n]=C({file:C({symlink:r.f.l})})))}return t}function R(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[n].charCodeAt(0);return t}let U=null,I=null,M={};const T=new TextDecoder,z=new TextEncoder,F=class e{constructor(e,n,r,s){t(this,"_instance"),t(this,"_runtimeInfo"),t(this,"fs"),t(this,"_tornDown",!1),t(this,"_unsubscribeFromTokenChangedListener",()=>{}),this._instance=e,this._runtimeInfo=s,this.fs=new B(n)}async spawn(e,t,n){let r,s=[];Array.isArray(t)?s=t:n=t;let i,a,o=new ReadableStream;if(!1!==n?.output){const e=function(){let e=null;const t=new ReadableStream({start(t){e=t}});return{stream:t,push:t=>{null!=t?e?.enqueue(t):(e?.close(),e=null)}}}();r=e.push,o=e.stream}const c=V(Q(r)),l=V(Q(i)),u=V(Q(a)),h=await this._instance.run({command:e,args:s,cwd:n?.cwd,env:n?.env,terminal:n?.terminal},l,u,c);return new J(h,o,undefined,undefined)}async export(e,t){const n={format:t?.format??"json",includes:t?.includes,excludes:t?.excludes,external:!0},r=await this._instance.serialize(e,n);if("json"===n.format){return N(JSON.parse(T.decode(r)))}return r}on(e,t){if("preview-message"===e){const e=t;t=t=>{var n;null!=(n=t)&&"object"==typeof n&&"type"in n&&S.includes(n.type)&&e(t)}}const{listener:n,subscribe:r}=function(e){let t=!1,n=()=>{};const r=(...n)=>{t||e(...n)};return{subscribe:e=>(e.then(e=>{n=e,t&&n()}),()=>{t=!0,n()}),listener:r}}(t);return r(this._instance.on(e,c.proxy(n)))}mount(e,t){const n=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):z.encode(JSON.stringify(j(e)));return this._instance.loadFiles(c.transfer(n,[n.buffer]),{mountPoints:t?.mountPoint})}setPreviewScript(e,t){return this._instance.setPreviewScript(e,t)}get path(){return this._runtimeInfo.path}get workdir(){return this._runtimeInfo.cwd}teardown(){if(this._tornDown)throw new Error("WebContainer already torn down");this._tornDown=!0,this._unsubscribeFromTokenChangedListener();e._teardownPromise=(async()=>{try{await this.fs._teardown(),await this._instance.teardown()}finally{this._instance[c.releaseProxy](),e._instance===this&&(e._instance=null)}})()}static async boot(t={}){await this._teardownPromise,e._teardownPromise=null;const{workdirName:n}=t;if(window.crossOriginIsolated&&t.coep,n?.includes("/")||".."===n||"."===n)throw new Error("workdirName should be a valid folder name");for(;U;)await U;if(e._instance)throw new Error("Only a single WebContainer instance can be booted");const r=async function(e){const{serverPromise:t}=function(e){if(null!=I)return e.coep,M.coep,{serverPromise:I};e.coep&&s.setQueryParam("coep",e.coep);e.experimentalNode&&s.setQueryParam("experimental_node","1");const t=document.createElement("iframe");t.style.display="none",t.setAttribute("allow","cross-origin-isolated");const n=s.url;t.src=n.toString();const{origin:r}=n;return M={...e},I=new Promise(e=>{const t=t=>{if(t.origin!==r)return;const{data:n}=t;"init"!==n.type?n.type:e(c.wrap(t.ports[0]))};window.addEventListener("message",t)}),document.body.insertBefore(t,null),{serverPromise:I}}(e),n=await t,r=await n.build({host:window.location.host,version:"1.6.1",workdirName:e.workdirName,forwardPreviewErrors:e.forwardPreviewErrors}),[i,a,o]=await Promise.all([r.fs(),r.previewScript(),r.runtimeInfo()]);return new W(r,i,a,o)}(t);U=r.catch(()=>{});try{const t=await r;return e._instance=t,t}finally{U=null}}};t(F,"_instance",null),t(F,"_teardownPromise",null);let W=F;class D{constructor(e,n){t(this,"name"),t(this,"_type"),this.name=e,this._type=n}isFile(){return 1===this._type}isDirectory(){return 2===this._type}}class H{constructor(e,n,r,s){t(this,"_apiClient"),t(this,"_path"),t(this,"_options"),t(this,"_listener"),t(this,"_wrappedListener"),t(this,"_watcher"),t(this,"_closed",!1),this._apiClient=e,this._path=n,this._options=r,this._listener=s,this._apiClient._watchers.add(this),this._wrappedListener=(e,t)=>{this._listener&&!this._closed&&this._listener(e,t)},this._apiClient._fs.watch(this._path,this._options,V(this._wrappedListener)).then(e=>{if(this._watcher=e,this._closed)return this._teardown()}).catch(console.error)}async close(){this._closed||(this._closed=!0,this._apiClient._watchers.delete(this),await this._teardown())}async _teardown(){await(this._watcher?.close().finally(()=>{this._watcher?.[c.releaseProxy]()}))}}class J{constructor(e,n,r,s){t(this,"output"),t(this,"input"),t(this,"exit"),t(this,"_process"),t(this,"stdout"),t(this,"stderr"),this.output=n,this._process=e,this.input=new WritableStream({write:e=>{this._getProcess()?.write(e).catch(()=>{})}}),this.exit=this._onExit(),this.stdout=r,this.stderr=s}kill(){this._process?.kill()}resize(e){this._getProcess()?.resize(e)}async _onExit(){try{return await this._process.onExit}finally{this._process?.[c.releaseProxy](),this._process=null}}_getProcess(){return this._process,this._process}}class B{constructor(e){t(this,"_fs"),t(this,"_watchers",new Set([])),this._fs=e}rm(...e){return this._fs.rm(...e)}async readFile(e,t){return await this._fs.readFile(e,t)}async rename(e,t){return await this._fs.rename(e,t)}async writeFile(e,t,n){if(t instanceof Uint8Array){const e=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);t=c.transfer(new Uint8Array(e),[e])}await this._fs.writeFile(e,t,n)}async readdir(e,t){const n=await this._fs.readdir(e,t);if("string"==typeof n[0])return n;if(function(e){return e[0]instanceof Uint8Array}(n))return n;return n.map(e=>new D(e.name,e["Symbol(type)"]))}async mkdir(e,t){return await this._fs.mkdir(e,t)}watch(e,t,n){return"function"==typeof t&&(n=t,t=null),new H(this,e,t,n)}async _teardown(){this._fs[c.releaseProxy](),await Promise.all([...this._watchers].map(e=>e.close()))}}function Q(e){if(null!=e)return t=>{t instanceof Uint8Array?e(T.decode(t)):null==t&&e(null)}}function V(e){if(null!=e)return c.proxy(e)}export{W};
//# sourceMappingURL=webcontainer-B_DT545e.js.map

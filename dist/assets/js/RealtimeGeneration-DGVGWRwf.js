var e=Object.defineProperty,s=(s,a,t)=>((s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t)(s,"symbol"!=typeof a?a+"":a,t);import{j as a}from"./ui-Ct5cQbGm.js";import{r as t}from"./router-BzeIgkns.js";import{c as n,k as r,u as i,C as l,a as o,b as c,d,B as m}from"./index-BGFRk5FI.js";import{B as u}from"./badge-CutB9wkN.js";import{S as g}from"./scroll-area-CWPF13ZN.js";import{c as h,F as p,H as x,I as j,J as w,K as f}from"./firebase-rW0Qch21.js";import{P as y,w as b,K as v,c as N,C as G,a as S,O as P,x as k,r as D}from"./icons-MbMX8aHs.js";import"./vendor-DEQ385Nk.js";import"./utils-Bmne0XXo.js";import"./index-jVOyRz7F.js";const M=t.forwardRef(({className:e,value:s=0,max:t=100,...r},i)=>{const l=Math.min(100,Math.max(0,s/t*100));return a.jsx("div",{ref:i,className:n("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:a.jsx("div",{className:"h-full bg-primary transition-all duration-300 ease-in-out",style:{width:`${l}%`}})})});M.displayName="Progress";const T=class e{constructor(){s(this,"database",h(r)),s(this,"listeners",new Map)}static getInstance(){return e.instance||(e.instance=new e),e.instance}async startGenerationSession(e,s){const a=p(this.database,`generations/${e}`),t={sessionId:e,userId:s,status:"initializing",progress:0,currentStep:"Starting AI generation...",timestamp:Date.now()};await x(a,{...t,createdAt:f()})}async updateProgress(e,s,a,t,n){const r=p(this.database,`generations/${e}`),i={status:s,progress:a,currentStep:t,timestamp:Date.now()};n&&(i.files=n),await x(r,{...i,updatedAt:f()})}async completeGeneration(e,s){await this.updateProgress(e,"completed",100,"Generation completed successfully",s)}async errorGeneration(e,s){const a=p(this.database,`generations/${e}`);await x(a,{status:"error",progress:0,currentStep:"Generation failed",error:s,timestamp:Date.now(),updatedAt:f()})}subscribeToGeneration(e,s){const a=p(this.database,`generations/${e}`),t=j(a,e=>{const a=e.val();a&&s(a)});return this.listeners.set(e,t),()=>{w(a,"value",t),this.listeners.delete(e)}}async sendMessage(e,s){const a=p(this.database,`messages/${e}/${Date.now()}`);await x(a,{...s,createdAt:f()})}subscribeToMessages(e,s){const a=p(this.database,`messages/${e}`),t=j(a,e=>{const a=e.val();if(a){const e=Object.keys(a).sort(),t=a[e[e.length-1]];t&&s(t)}}),n=`messages_${e}`;return this.listeners.set(n,t),()=>{w(a,"value",t),this.listeners.delete(n)}}async getGenerationStatus(e){return new Promise(s=>{const a=p(this.database,`generations/${e}`);j(a,e=>{const a=e.val();s(a)},{onlyOnce:!0})})}async cleanupOldSessions(e=24){Date.now()}disconnectAll(){this.listeners.forEach(e=>{e()}),this.listeners.clear()}async streamGeneration(e,s,a,t){await this.startGenerationSession(e,s);const n=this.subscribeToGeneration(e,a),r=this.subscribeToMessages(e,t);try{await this.updateProgress(e,"analyzing",10,"Analyzing requirements..."),await this.sendMessage(e,{type:"progress",data:{step:"analyzing",message:"Breaking down your requirements..."},timestamp:Date.now()}),await new Promise(e=>setTimeout(e,2e3)),await this.updateProgress(e,"generating",30,"Generating code structure..."),await this.sendMessage(e,{type:"progress",data:{step:"generating",message:"Creating project structure..."},timestamp:Date.now()});const s=[{name:"package.json",path:"/package.json",content:JSON.stringify({name:"generated-app",version:"1.0.0"},null,2),language:"json"},{name:"index.html",path:"/index.html",content:"<!DOCTYPE html><html><head><title>Generated App</title></head><body><h1>Hello World</h1></body></html>",language:"html"}];for(let a=0;a<s.length;a++){const t=s[a],n=30+20*(a+1);await this.updateProgress(e,"generating",n,`Generating ${t.name}...`,s.slice(0,a+1)),await this.sendMessage(e,{type:"file",data:t,timestamp:Date.now()}),await new Promise(e=>setTimeout(e,1500))}await this.updateProgress(e,"reviewing",80,"Reviewing generated code..."),await this.sendMessage(e,{type:"progress",data:{step:"reviewing",message:"Optimizing and reviewing code quality..."},timestamp:Date.now()}),await new Promise(e=>setTimeout(e,2e3)),await this.completeGeneration(e,s),await this.sendMessage(e,{type:"complete",data:{files:s,message:"Generation completed successfully!"},timestamp:Date.now()})}catch(i){await this.errorGeneration(e,i instanceof Error?i.message:"Unknown error"),await this.sendMessage(e,{type:"error",data:{error:i instanceof Error?i.message:"Unknown error"},timestamp:Date.now()})}finally{setTimeout(()=>{n(),r()},1e4)}}};s(T,"instance");let C=T;function A(){const{user:e}=i(),{isGenerating:s,progress:n,messages:r,error:h,startGeneration:p,stopGeneration:x,clearGeneration:j}=(()=>{const[e,s]=t.useState({isGenerating:!1,progress:null,messages:[],error:null}),a=C.getInstance(),n=t.useRef([]),r=t.useCallback(async e=>{const t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;s(e=>({...e,isGenerating:!0,progress:null,messages:[],error:null}));try{const r=a.subscribeToGeneration(t,e=>{s(s=>({...s,progress:e,error:e.error||null})),"completed"!==e.status&&"error"!==e.status||s(e=>({...e,isGenerating:!1}))}),i=a.subscribeToMessages(t,e=>{s(s=>({...s,messages:[...s.messages,e]}))});return n.current=[r,i],await a.streamGeneration(t,e,e=>{},e=>{}),t}catch(h){throw s(s=>({...s,isGenerating:!1,error:h instanceof Error?h.message:"Generation failed"})),h}},[a]),i=t.useCallback(()=>{n.current.forEach(e=>e()),n.current=[],s(e=>({...e,isGenerating:!1}))},[]),l=t.useCallback(()=>{s({isGenerating:!1,progress:null,messages:[],error:null})},[]),o=t.useCallback(async e=>await a.getGenerationStatus(e),[a]),c=t.useCallback(e=>{s(e=>({...e,isGenerating:!0,error:null}));const t=a.subscribeToGeneration(e,e=>{s(s=>({...s,progress:e,error:e.error||null})),"completed"!==e.status&&"error"!==e.status||s(e=>({...e,isGenerating:!1}))}),r=a.subscribeToMessages(e,e=>{s(s=>({...s,messages:[...s.messages,e]}))});n.current=[t,r]},[a]);return t.useEffect(()=>()=>{n.current.forEach(e=>e()),a.disconnectAll()},[a]),{...e,startGeneration:r,stopGeneration:i,clearGeneration:l,getGenerationStatus:o,resumeGeneration:c}})(),[w,f]=t.useState(null);return a.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[a.jsxs(l,{children:[a.jsx(o,{children:a.jsxs(c,{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Real-time AI Generation"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[(()=>{if(!n)return null;const e={initializing:{variant:"secondary",icon:D,text:"Initializing"},analyzing:{variant:"default",icon:k,text:"Analyzing"},generating:{variant:"default",icon:N,text:"Generating"},reviewing:{variant:"default",icon:P,text:"Reviewing"},completed:{variant:"default",icon:S,text:"Completed"},error:{variant:"destructive",icon:G,text:"Error"}}[n.status],s=e.icon;return a.jsxs(u,{variant:e.variant,className:"flex items-center space-x-1",children:[a.jsx(s,{className:"h-3 w-3 "+("analyzing"===n.status||"generating"===n.status?"animate-spin":"")}),a.jsx("span",{children:e.text})]})})(),w&&a.jsx(u,{variant:"outline",className:"font-mono text-xs",children:w})]})]})}),a.jsxs(d,{className:"space-y-4",children:[a.jsx("p",{className:"text-muted-foreground",children:"This demonstrates real-time AI generation with live progress updates using Firebase Realtime Database."}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(m,{onClick:async()=>{if(e)try{const s=await p(e.uid);f(s)}catch(s){}else alert("Please login to start generation")},disabled:s||!e,className:"flex items-center space-x-2",children:[a.jsx(y,{className:"h-4 w-4"}),a.jsx("span",{children:"Start Generation"})]}),s&&a.jsxs(m,{variant:"destructive",onClick:()=>{x()},className:"flex items-center space-x-2",children:[a.jsx(b,{className:"h-4 w-4"}),a.jsx("span",{children:"Stop"})]}),a.jsxs(m,{variant:"outline",onClick:()=>{j(),f(null)},className:"flex items-center space-x-2",children:[a.jsx(v,{className:"h-4 w-4"}),a.jsx("span",{children:"Clear"})]})]}),n&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"font-medium",children:n.currentStep}),a.jsxs("span",{className:"text-muted-foreground",children:[n.progress,"%"]})]}),a.jsx(M,{value:n.progress,className:"w-full"})]}),h&&a.jsxs(l,{className:"border-destructive",children:[a.jsx(o,{className:"pb-2",children:a.jsx(c,{className:"text-destructive text-sm",children:"Error"})}),a.jsx(d,{children:a.jsx("pre",{className:"text-sm text-destructive whitespace-pre-wrap",children:h})})]})]})]}),n?.files&&n.files.length>0&&a.jsxs(l,{children:[a.jsx(o,{children:a.jsxs(c,{children:["Generated Files (",n.files.length,")"]})}),a.jsx(d,{children:a.jsx("div",{className:"space-y-4",children:n.files.map((e,s)=>a.jsxs(l,{className:"border",children:[a.jsx(o,{className:"pb-2",children:a.jsxs(c,{className:"text-sm flex items-center space-x-2",children:[a.jsx(N,{className:"h-4 w-4"}),a.jsx("span",{className:"font-mono",children:e.name}),a.jsx(u,{variant:"outline",className:"text-xs",children:e.language})]})}),a.jsx(d,{children:a.jsx(g,{className:"h-32 w-full",children:a.jsx("pre",{className:"text-xs font-mono whitespace-pre-wrap bg-muted p-2 rounded",children:e.content})})})]},s))})})]}),r.length>0&&a.jsxs(l,{children:[a.jsx(o,{children:a.jsxs(c,{children:["Live Updates (",r.length,")"]})}),a.jsx(d,{children:a.jsx(g,{className:"h-64 w-full",children:a.jsx("div",{className:"space-y-2",children:r.map((e,s)=>a.jsxs("div",{className:"flex items-start space-x-2 p-2 bg-muted/50 rounded",children:[a.jsx(u,{variant:"outline",className:"text-xs",children:e.type}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"text-sm",children:"file"===e.type?a.jsx("span",{className:"font-mono",children:e.data.name}):a.jsx("span",{children:e.data.message||JSON.stringify(e.data)})}),a.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(e.timestamp).toLocaleTimeString()})]})]},s))})})})]}),!e&&a.jsxs(l,{className:"border-yellow-200 bg-yellow-50",children:[a.jsx(o,{children:a.jsx(c,{className:"text-yellow-800",children:"Authentication Required"})}),a.jsx(d,{children:a.jsx("p",{className:"text-yellow-700",children:"Please login to test the real-time generation features."})})]})]})}export{A as RealtimeGeneration};
//# sourceMappingURL=RealtimeGeneration-DGVGWRwf.js.map
